# ğŸ—ºï¸ TECHNICAL MINDMAP - DATA ENGINEERING + MLOps (AWS + SNOWFLAKE)

Got it! You want **PURE TECHNICAL ARCHITECTURE MINDMAP** showing how data flows and what tech does what. Here it is!

---

## ğŸ¯ **MASTER TECHNICAL ARCHITECTURE - ONE GLANCE VIEW**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘        ğŸ­ TATA CONSUMER PRODUCTS (TCPL) - CPG ANALYTICS PLATFORM             â•‘
â•‘               Complete Data Engineering + MLOps Technical Stack              â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                            ğŸ“Š DATA SOURCES
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚                         â”‚
        â–¼                         â–¼                         â–¼
   ğŸª POS Data              ğŸ“± Mobile Apps            ğŸŒ Web Events
   (Retail Stores)         (Customer behavior)        (E-commerce)
   â€¢ Transactions          â€¢ App clicks               â€¢ Page views
   â€¢ Sales                 â€¢ Purchases                â€¢ Cart events
   â€¢ Promotions            â€¢ Location                 â€¢ Checkouts
        â”‚                         â”‚                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   BATCH INGESTION    â”‚    â”‚  STREAM INGESTION    â”‚
        â”‚   (Daily files)      â”‚    â”‚  (Real-time events)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                           â”‚
                   â–¼                           â–¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           BATCH PIPELINE (LEFT)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¥ STEP 1: LANDING ZONE (S3)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   S3 Bucket: s3://tcpl-landing/                                            â”‚
â”‚   â”œâ”€â”€ sales/daily/sales_20240220.csv                                       â”‚
â”‚   â”œâ”€â”€ promotions/daily/promos_20240220.csv                                 â”‚
â”‚   â””â”€â”€ inventory/daily/inventory_20240220.csv                               â”‚
â”‚                                                                             â”‚
â”‚   Format: CSV files from source systems                                     â”‚
â”‚   Frequency: Daily (uploaded at 1 AM)                                      â”‚
â”‚   Trigger: S3 Event â†’ Lambda â†’ Glue Job                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥‰ STEP 2: BRONZE LAYER (AWS GLUE)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Technology: AWS Glue ETL (PySpark)                                       â”‚
â”‚   Job Name: bronze-promo-ingestion                                         â”‚
â”‚                                                                             â”‚
â”‚   What it does:                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 1. READ CSV from S3 Landing                                  â”‚        â”‚
â”‚   â”‚    â”œâ”€ Schema discovery via Glue Crawler                      â”‚        â”‚
â”‚   â”‚    â””â”€ Load into Spark DataFrame                              â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 2. DATA VALIDATION                                            â”‚        â”‚
â”‚   â”‚    â”œâ”€ Check NULLs in critical columns                        â”‚        â”‚
â”‚   â”‚    â”œâ”€ Validate data types                                    â”‚        â”‚
â”‚   â”‚    â”œâ”€ Check ranges (discount 0-100%)                         â”‚        â”‚
â”‚   â”‚    â”œâ”€ Remove duplicates                                      â”‚        â”‚
â”‚   â”‚    â””â”€ Reject if >5% bad data                                 â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 3. ADD METADATA                                               â”‚        â”‚
â”‚   â”‚    â”œâ”€ ingestion_timestamp                                    â”‚        â”‚
â”‚   â”‚    â”œâ”€ source_file                                            â”‚        â”‚
â”‚   â”‚    â”œâ”€ job_run_id                                             â”‚        â”‚
â”‚   â”‚    â””â”€ data_quality_flag                                      â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 4. WRITE to Bronze S3                                        â”‚        â”‚
â”‚   â”‚    â”œâ”€ Format: Parquet (compressed with Snappy)              â”‚        â”‚
â”‚   â”‚    â”œâ”€ Partition: By ingestion_date                          â”‚        â”‚
â”‚   â”‚    â””â”€ Location: s3://tcpl-bronze/promotions/                â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 5. UPDATE Glue Data Catalog                                  â”‚        â”‚
â”‚   â”‚    â””â”€ Table: bronze_db.promotions_raw                        â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 6. SEND METRICS to CloudWatch                                â”‚        â”‚
â”‚   â”‚    â”œâ”€ RecordsProcessed                                       â”‚        â”‚
â”‚   â”‚    â”œâ”€ RecordsRejected                                        â”‚        â”‚
â”‚   â”‚    â””â”€ RejectionRate                                          â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â”‚   Output: s3://tcpl-bronze/promotions/ingestion_date=2024-02-20/          â”‚
â”‚           â”œâ”€â”€ part-00000.parquet (45,444 records)                         â”‚
â”‚           â””â”€â”€ part-00001.parquet                                           â”‚
â”‚                                                                             â”‚
â”‚   Glue Job Config:                                                          â”‚
â”‚   â”œâ”€ Worker type: G.1X (4 vCPU, 16 GB RAM)                                â”‚
â”‚   â”œâ”€ Number of workers: 5                                                  â”‚
â”‚   â”œâ”€ Timeout: 60 minutes                                                   â”‚
â”‚   â””â”€ Retries: 2                                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥ˆ STEP 3: SILVER LAYER (AWS GLUE - ADVANCED TRANSFORMATIONS)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Technology: AWS Glue ETL (PySpark)                                       â”‚
â”‚   Job Name: silver-promo-transformation                                    â”‚
â”‚                                                                             â”‚
â”‚   What it does:                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ 1. READ from Bronze (Parquet)                                â”‚        â”‚
â”‚   â”‚    â””â”€ Source: s3://tcpl-bronze/promotions/                   â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 2. DATA CLEANING                                              â”‚        â”‚
â”‚   â”‚    â”œâ”€ Remove test records (promotion_id starts with TEST_)   â”‚        â”‚
â”‚   â”‚    â”œâ”€ Deduplicate (keep latest by timestamp)                 â”‚        â”‚
â”‚   â”‚    â””â”€ Filter bad quality records                             â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 3. BUSINESS LOGIC TRANSFORMATIONS                            â”‚        â”‚
â”‚   â”‚    â”œâ”€ Calculate promo_duration_days                          â”‚        â”‚
â”‚   â”‚    â”‚   = datediff(end_date, start_date) + 1                  â”‚        â”‚
â”‚   â”‚    â”‚                                                          â”‚        â”‚
â”‚   â”‚    â”œâ”€ Categorize discount_category                           â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ <10%: Low                                           â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ 10-25%: Medium                                      â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ 25-50%: High                                        â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ >50%: Very High                                     â”‚        â”‚
â”‚   â”‚    â”‚                                                          â”‚        â”‚
â”‚   â”‚    â”œâ”€ Calculate budget_per_day                               â”‚        â”‚
â”‚   â”‚    â”‚   = budget_usd / promo_duration_days                    â”‚        â”‚
â”‚   â”‚    â”‚                                                          â”‚        â”‚
â”‚   â”‚    â”œâ”€ Extract temporal features                              â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ promo_start_year, month, quarter                    â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ day_of_week, week_of_year                           â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ is_weekend (1 if Sat/Sun)                           â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ season (Winter/Spring/Summer/Fall)                  â”‚        â”‚
â”‚   â”‚    â”‚                                                          â”‚        â”‚
â”‚   â”‚    â””â”€ Calculate promo_intensity_score                        â”‚        â”‚
â”‚   â”‚        = (discount_pct Ã— duration Ã— budget_per_day) / 1000   â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 4. JOIN WITH MASTER DATA                                     â”‚        â”‚
â”‚   â”‚    â”œâ”€ Product Master (from Glue Catalog)                     â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ product_name, brand, category                       â”‚        â”‚
â”‚   â”‚    â”‚   â€¢ unit_price, cost_price                              â”‚        â”‚
â”‚   â”‚    â”‚                                                          â”‚        â”‚
â”‚   â”‚    â””â”€ Store Master                                           â”‚        â”‚
â”‚   â”‚        â€¢ store_name, store_type                              â”‚        â”‚
â”‚   â”‚        â€¢ region, state, city                                 â”‚        â”‚
â”‚   â”‚        â€¢ size_sqft, avg_daily_foottraffic                    â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 5. CALCULATE FINANCIAL METRICS                               â”‚        â”‚
â”‚   â”‚    â”œâ”€ margin_before_promo = unit_price - cost_price         â”‚        â”‚
â”‚   â”‚    â”œâ”€ discounted_price = unit_price Ã— (1 - discount_pct/100)â”‚        â”‚
â”‚   â”‚    â”œâ”€ margin_after_promo = discounted_price - cost_price    â”‚        â”‚
â”‚   â”‚    â”œâ”€ margin_erosion_pct                                     â”‚        â”‚
â”‚   â”‚    â”œâ”€ margin_erosion_usd                                     â”‚        â”‚
â”‚   â”‚    â”œâ”€ effective_discount_usd                                 â”‚        â”‚
â”‚   â”‚    â””â”€ is_unprofitable (flag if margin < 0)                   â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 6. ADD RISK FLAGS                                            â”‚        â”‚
â”‚   â”‚    â”œâ”€ high_risk_flag (if unprofitable OR margin erosion >75%)â”‚        â”‚
â”‚   â”‚    â”œâ”€ risk_category (Unprofitable/High Margin/Deep Discount) â”‚        â”‚
â”‚   â”‚    â””â”€ value_tier (Low/Medium/High/Strategic based on budget) â”‚        â”‚
â”‚   â”‚                                                               â”‚        â”‚
â”‚   â”‚ 7. WRITE to Silver S3                                        â”‚        â”‚
â”‚   â”‚    â”œâ”€ Format: Parquet                                        â”‚        â”‚
â”‚   â”‚    â”œâ”€ Partition: By promo_start_year, promo_start_month     â”‚        â”‚
â”‚   â”‚    â””â”€ Location: s3://tcpl-silver/promotions_enriched/       â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â”‚   Output: s3://tcpl-silver/promotions_enriched/                            â”‚
â”‚           year=2024/month=02/part-00000.parquet                            â”‚
â”‚           â€¢ All original fields                                            â”‚
â”‚           â€¢ + 30+ derived fields                                           â”‚
â”‚           â€¢ + Financial metrics                                            â”‚
â”‚           â€¢ + Risk indicators                                              â”‚
â”‚                                                                             â”‚
â”‚   Glue Job Config:                                                          â”‚
â”‚   â”œâ”€ Worker type: G.1X                                                     â”‚
â”‚   â”œâ”€ Number of workers: 10                                                 â”‚
â”‚   â”œâ”€ Timeout: 120 minutes                                                  â”‚
â”‚   â””â”€ Clustering: By year, month, category                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥‡ STEP 4: GOLD LAYER (SNOWFLAKE + dbt)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ PHASE 1: LOAD TO SNOWFLAKE (Snowpipe)                     â”‚          â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ S3 Event â†’ SQS â†’ Snowpipe â†’ Snowflake Table               â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Setup:                                                      â”‚          â”‚
â”‚   â”‚ 1. Create External Stage in Snowflake                     â”‚          â”‚
â”‚   â”‚    CREATE STAGE S3_SILVER_STAGE                            â”‚          â”‚
â”‚   â”‚      STORAGE_INTEGRATION = S3_TCPL_INTEGRATION             â”‚          â”‚
â”‚   â”‚      URL = 's3://tcpl-silver/promotions_enriched/'         â”‚          â”‚
â”‚   â”‚      FILE_FORMAT = (TYPE = PARQUET);                       â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 2. Create Staging Table                                    â”‚          â”‚
â”‚   â”‚    Database: ANALYTICS_PROD                                â”‚          â”‚
â”‚   â”‚    Schema: STAGING                                         â”‚          â”‚
â”‚   â”‚    Table: STG_PROMOTIONS_ENRICHED                          â”‚          â”‚
â”‚   â”‚    â€¢ All Silver layer fields                               â”‚          â”‚
â”‚   â”‚    â€¢ + _SNOWFLAKE_LOADED_AT (timestamp)                    â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 3. Create Snowpipe (Auto-ingest)                           â”‚          â”‚
â”‚   â”‚    CREATE PIPE PIPE_PROMOTIONS_ENRICHED                    â”‚          â”‚
â”‚   â”‚      AUTO_INGEST = TRUE                                    â”‚          â”‚
â”‚   â”‚      AS                                                     â”‚          â”‚
â”‚   â”‚        COPY INTO STG_PROMOTIONS_ENRICHED                   â”‚          â”‚
â”‚   â”‚        FROM @S3_SILVER_STAGE                               â”‚          â”‚
â”‚   â”‚        FILE_FORMAT = (TYPE = PARQUET);                     â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 4. Configure S3 Event Notification                         â”‚          â”‚
â”‚   â”‚    S3 Bucket: tcpl-silver                                  â”‚          â”‚
â”‚   â”‚    Event: ObjectCreated:*                                  â”‚          â”‚
â”‚   â”‚    Target: SQS Queue (from Snowpipe)                       â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Result: Data auto-loads to Snowflake within minutes!      â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ PHASE 2: dbt TRANSFORMATIONS (Gold Tables)                â”‚          â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Technology: dbt (Data Build Tool)                          â”‚          â”‚
â”‚   â”‚ Runs in: Snowflake (SQL transformations)                   â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ dbt Models Structure:                                       â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ models/                                                     â”‚          â”‚
â”‚   â”‚ â”œâ”€ staging/                                                â”‚          â”‚
â”‚   â”‚ â”‚  â””â”€ stg_promotions.sql                                   â”‚          â”‚
â”‚   â”‚ â”‚     (View on STG_PROMOTIONS_ENRICHED)                    â”‚          â”‚
â”‚   â”‚ â”‚                                                           â”‚          â”‚
â”‚   â”‚ â”œâ”€ marts/core/                                             â”‚          â”‚
â”‚   â”‚ â”‚  â”œâ”€ monthly_promo_summary.sql                            â”‚          â”‚
â”‚   â”‚ â”‚  â”œâ”€ product_promo_performance.sql                        â”‚          â”‚
â”‚   â”‚ â”‚  â”œâ”€ brand_promo_effectiveness.sql                        â”‚          â”‚
â”‚   â”‚ â”‚  â””â”€ regional_promo_analysis.sql                          â”‚          â”‚
â”‚   â”‚ â”‚                                                           â”‚          â”‚
â”‚   â”‚ â””â”€ marts/finance/                                          â”‚          â”‚
â”‚   â”‚    â””â”€ promo_roi_dashboard.sql                              â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ MODEL 1: monthly_promo_summary                             â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚          â”‚
â”‚   â”‚ SELECT                                                      â”‚          â”‚
â”‚   â”‚   promo_start_year,                                        â”‚          â”‚
â”‚   â”‚   promo_start_month,                                       â”‚          â”‚
â”‚   â”‚   region,                                                   â”‚          â”‚
â”‚   â”‚   COUNT(DISTINCT promotion_id) AS total_promotions,       â”‚          â”‚
â”‚   â”‚   SUM(budget_usd) AS total_budget,                         â”‚          â”‚
â”‚   â”‚   AVG(discount_percentage) AS avg_discount,               â”‚          â”‚
â”‚   â”‚   SUM(CASE WHEN is_unprofitable=1 THEN 1 END)             â”‚          â”‚
â”‚   â”‚     AS unprofitable_count                                  â”‚          â”‚
â”‚   â”‚ FROM {{ ref('stg_promotions') }}                           â”‚          â”‚
â”‚   â”‚ GROUP BY 1,2,3                                             â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Materialized as: TABLE                                     â”‚          â”‚
â”‚   â”‚ Clustered by: year, month                                  â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ MODEL 2: product_promo_performance                         â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚          â”‚
â”‚   â”‚ SELECT                                                      â”‚          â”‚
â”‚   â”‚   product_id,                                              â”‚          â”‚
â”‚   â”‚   product_name,                                            â”‚          â”‚
â”‚   â”‚   brand,                                                    â”‚          â”‚
â”‚   â”‚   category,                                                â”‚          â”‚
â”‚   â”‚   COUNT(DISTINCT promotion_id) AS total_promotions,       â”‚          â”‚
â”‚   â”‚   SUM(budget_usd) AS total_budget_invested,               â”‚          â”‚
â”‚   â”‚   AVG(discount_percentage) AS avg_discount,               â”‚          â”‚
â”‚   â”‚   AVG(margin_erosion_pct) AS avg_margin_erosion,          â”‚          â”‚
â”‚   â”‚   SUM(CASE WHEN is_unprofitable=1 THEN 1 END)             â”‚          â”‚
â”‚   â”‚     AS unprofitable_promo_count                            â”‚          â”‚
â”‚   â”‚ FROM {{ ref('stg_promotions') }}                           â”‚          â”‚
â”‚   â”‚ GROUP BY 1,2,3,4                                           â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Materialized as: TABLE                                     â”‚          â”‚
â”‚   â”‚ Clustered by: category, brand                              â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ dbt Tests:                                                  â”‚          â”‚
â”‚   â”‚ â€¢ not_null: promotion_id, product_id                       â”‚          â”‚
â”‚   â”‚ â€¢ unique: promotion_id                                      â”‚          â”‚
â”‚   â”‚ â€¢ accepted_range: discount_percentage (0-100)             â”‚          â”‚
â”‚   â”‚ â€¢ relationships: product_id exists in product_master      â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ dbt Run Command:                                            â”‚          â”‚
â”‚   â”‚   dbt run --target prod                                    â”‚          â”‚
â”‚   â”‚   dbt test --target prod                                   â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚   Final Gold Tables in Snowflake:                                          â”‚
â”‚   Database: ANALYTICS_PROD                                                  â”‚
â”‚   Schema: GOLD                                                              â”‚
â”‚   Tables:                                                                   â”‚
â”‚   â”œâ”€ MONTHLY_PROMO_SUMMARY (12K rows - monthly aggregates)                â”‚
â”‚   â”œâ”€ PRODUCT_PROMO_PERFORMANCE (5K rows - per product)                    â”‚
â”‚   â”œâ”€ BRAND_PROMO_EFFECTIVENESS (45 rows - per brand)                      â”‚
â”‚   â”œâ”€ REGIONAL_PROMO_ANALYSIS (156 rows - per region)                      â”‚
â”‚   â””â”€ PROMO_ROI_DASHBOARD (45K rows - promo-level detail)                  â”‚
â”‚                                                                             â”‚
â”‚   Clustering: Applied for fast queries                                     â”‚
â”‚   Permissions: Granted to ANALYST role (read-only)                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        STREAMING PIPELINE (RIGHT SIDE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒŠ REAL-TIME STREAMING ARCHITECTURE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“± Data Sources (Real-time)                                              â”‚
â”‚   â”œâ”€ POS Transactions (10K events/sec)                                     â”‚
â”‚   â”œâ”€ Mobile App Events (5K events/sec)                                     â”‚
â”‚   â””â”€ IoT Sensors (2K events/sec)                                           â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ KAFKA PRODUCERS (Event Publishers)                       â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Producer Code: Python (kafka-python library)             â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ from kafka import KafkaProducer                          â”‚            â”‚
â”‚   â”‚ producer = KafkaProducer(                                â”‚            â”‚
â”‚   â”‚   bootstrap_servers=['b-1.msk:9092', 'b-2.msk:9092'],  â”‚            â”‚
â”‚   â”‚   value_serializer=lambda v: json.dumps(v).encode()     â”‚            â”‚
â”‚   â”‚ )                                                         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ # Send transaction event                                 â”‚            â”‚
â”‚   â”‚ transaction = {                                           â”‚            â”‚
â”‚   â”‚   'transaction_id': 'TXN_12345',                         â”‚            â”‚
â”‚   â”‚   'timestamp': '2024-02-20T15:30:45Z',                   â”‚            â”‚
â”‚   â”‚   'store_id': 'ST_0001',                                 â”‚            â”‚
â”‚   â”‚   'product_id': 'SKU_1234',                              â”‚            â”‚
â”‚   â”‚   'quantity': 2,                                          â”‚            â”‚
â”‚   â”‚   'total_amount': 25.98,                                 â”‚            â”‚
â”‚   â”‚   'payment_method': 'Credit Card'                        â”‚            â”‚
â”‚   â”‚ }                                                         â”‚            â”‚
â”‚   â”‚ producer.send('transactions-stream', transaction)        â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ AMAZON MSK (Managed Kafka)                               â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Cluster: tcpl-kafka-prod                                 â”‚            â”‚
â”‚   â”‚ Brokers: 3 nodes (Multi-AZ)                              â”‚            â”‚
â”‚   â”‚ Instance: kafka.m5.large                                 â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Topics:                                                   â”‚            â”‚
â”‚   â”‚ â”œâ”€ transactions-stream (12 partitions, 7d retention)    â”‚            â”‚
â”‚   â”‚ â”œâ”€ promo-events (6 partitions, 7d retention)            â”‚            â”‚
â”‚   â”‚ â”œâ”€ inventory-updates (6 partitions, 7d retention)       â”‚            â”‚
â”‚   â”‚ â””â”€ fraud-alerts (3 partitions, 30d retention)           â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Replication Factor: 3                                    â”‚            â”‚
â”‚   â”‚ Compression: Snappy                                       â”‚            â”‚
â”‚   â”‚ Min In-Sync Replicas: 2                                  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ KAFKA CONSUMERS (Processing Layer)                       â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ CONSUMER 1: AWS Lambda                                   â”‚            â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚            â”‚
â”‚   â”‚ â€¢ Trigger: MSK Event Source Mapping                      â”‚            â”‚
â”‚   â”‚ â€¢ Batch Size: 100 messages                               â”‚            â”‚
â”‚   â”‚ â€¢ Processing:                                             â”‚            â”‚
â”‚   â”‚   1. Parse JSON messages                                 â”‚            â”‚
â”‚   â”‚   2. Validate & enrich                                   â”‚            â”‚
â”‚   â”‚   3. Fraud detection (check is_fraud flag)               â”‚            â”‚
â”‚   â”‚   4. Write to DynamoDB (real-time queries)               â”‚            â”‚
â”‚   â”‚   5. Write to S3 (archival)                              â”‚            â”‚
â”‚   â”‚   6. Send metrics to CloudWatch                          â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ CONSUMER 2: Apache Flink (Kinesis Data Analytics)       â”‚            â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚            â”‚
â”‚   â”‚ â€¢ For complex stream processing                          â”‚            â”‚
â”‚   â”‚ â€¢ Windowing operations:                                   â”‚            â”‚
â”‚   â”‚   - Tumbling window (5 min aggregations)                â”‚            â”‚
â”‚   â”‚   - Sliding window (10 min, slide 5 min)                â”‚            â”‚
â”‚   â”‚ â€¢ Stream-to-stream joins                                 â”‚            â”‚
â”‚   â”‚ â€¢ Pattern detection (CEP)                                â”‚            â”‚
â”‚   â”‚ â€¢ Output: Aggregated metrics to Snowflake               â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ SINKS (Where data goes)                                  â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 1. Amazon S3 (Data Lake)                                 â”‚            â”‚
â”‚   â”‚    Location: s3://tcpl-streaming/transactions/           â”‚            â”‚
â”‚   â”‚    Format: Parquet (hourly partitions)                   â”‚            â”‚
â”‚   â”‚    Partition: year=2024/month=02/day=20/hour=15/         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 2. Snowflake (Real-time Tables)                          â”‚            â”‚
â”‚   â”‚    Loading: Snowpipe Streaming API                       â”‚            â”‚
â”‚   â”‚    Table: ANALYTICS_PROD.REALTIME.TRANSACTIONS_STREAM    â”‚            â”‚
â”‚   â”‚    Latency: <2 seconds                                   â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 3. DynamoDB (Operational Queries)                        â”‚            â”‚
â”‚   â”‚    Table: RealTimeTransactions                           â”‚            â”‚
â”‚   â”‚    Key: transaction_id                                   â”‚            â”‚
â”‚   â”‚    TTL: 7 days                                           â”‚            â”‚
â”‚   â”‚    Use: <10ms lookups for customer service              â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 4. CloudWatch Metrics                                     â”‚            â”‚
â”‚   â”‚    Namespace: TCPL/Streaming                             â”‚            â”‚
â”‚   â”‚    Metrics: Events/sec, Lag, Errors                      â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        ML/MLOPS PIPELINE (SAGEMAKER)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– MACHINE LEARNING PIPELINE                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Use Case: Predict Promotional Sales Lift %                               â”‚
â”‚   Problem: Given a promotion, predict sales increase                       â”‚
â”‚   Target: sales_lift_pct = (promo_sales - baseline) / baseline Ã— 100      â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ STEP 1: FEATURE ENGINEERING (Snowflake Snowpark)        â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Technology: Snowflake Snowpark (Python in Snowflake)    â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Process:                                                  â”‚            â”‚
â”‚   â”‚ 1. Query historical data:                                â”‚            â”‚
â”‚   â”‚    SELECT promotions + sales data                        â”‚            â”‚
â”‚   â”‚    FROM GOLD.PROMO_ROI_DASHBOARD p                       â”‚            â”‚
â”‚   â”‚    JOIN HISTORICAL_SALES s                               â”‚            â”‚
â”‚   â”‚      ON p.promotion_id = s.promotion_id                  â”‚            â”‚
â”‚   â”‚    WHERE promo_status = 'Completed'                      â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 2. Calculate baseline sales:                             â”‚            â”‚
â”‚   â”‚    baseline_sales = AVG(daily_sales)                     â”‚            â”‚
â”‚   â”‚      WHERE has_promotion = 0                             â”‚            â”‚
â”‚   â”‚      AND date BETWEEN start_date-7 AND start_date-1     â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 3. Calculate target variable:                            â”‚            â”‚
â”‚   â”‚    sales_lift_pct =                                      â”‚            â”‚
â”‚   â”‚      (avg_promo_sales - baseline_sales) / baseline Ã— 100â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 4. Create features (30+ features):                       â”‚            â”‚
â”‚   â”‚    PROMOTIONAL FEATURES:                                 â”‚            â”‚
â”‚   â”‚    â€¢ discount_percentage                                 â”‚            â”‚
â”‚   â”‚    â€¢ promo_duration_days                                 â”‚            â”‚
â”‚   â”‚    â€¢ budget_per_day                                      â”‚            â”‚
â”‚   â”‚    â€¢ promo_intensity_score                               â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚    PRODUCT FEATURES:                                      â”‚            â”‚
â”‚   â”‚    â€¢ master_unit_price                                   â”‚            â”‚
â”‚   â”‚    â€¢ cost_price                                          â”‚            â”‚
â”‚   â”‚    â€¢ price_to_cost_ratio                                â”‚            â”‚
â”‚   â”‚    â€¢ category (label encoded)                            â”‚            â”‚
â”‚   â”‚    â€¢ brand (label encoded)                               â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚    TEMPORAL FEATURES:                                     â”‚            â”‚
â”‚   â”‚    â€¢ promo_start_month (1-12)                            â”‚            â”‚
â”‚   â”‚    â€¢ promo_start_day_of_week (1-7)                       â”‚            â”‚
â”‚   â”‚    â€¢ is_weekend_start (0/1)                              â”‚            â”‚
â”‚   â”‚    â€¢ is_holiday_aligned (0/1)                            â”‚            â”‚
â”‚   â”‚    â€¢ season (label encoded)                              â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚    STORE FEATURES:                                        â”‚            â”‚
â”‚   â”‚    â€¢ store_size_sqft                                     â”‚            â”‚
â”‚   â”‚    â€¢ avg_daily_foottraffic                               â”‚            â”‚
â”‚   â”‚    â€¢ region (label encoded)                              â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚    HISTORICAL FEATURES:                                   â”‚            â”‚
â”‚   â”‚    â€¢ baseline_sales (7-day avg)                          â”‚            â”‚
â”‚   â”‚    â€¢ sales_volatility (7-day std)                        â”‚            â”‚
â”‚   â”‚    â€¢ coefficient_of_variation                            â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚    INTERACTION FEATURES:                                  â”‚            â”‚
â”‚   â”‚    â€¢ discount_x_duration                                 â”‚            â”‚
â”‚   â”‚    â€¢ discount_x_weekend                                  â”‚            â”‚
â”‚   â”‚    â€¢ price_x_discount                                    â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 5. Feature Scaling:                                      â”‚            â”‚
â”‚   â”‚    StandardScaler for numerical features                 â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 6. Train/Test Split:                                     â”‚            â”‚
â”‚   â”‚    80/20 split (time-based)                              â”‚            â”‚
â”‚   â”‚    Older data â†’ Training                                 â”‚            â”‚
â”‚   â”‚    Recent data â†’ Testing                                 â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 7. Export to S3:                                         â”‚            â”‚
â”‚   â”‚    s3://tcpl-sagemaker/ml-features/train.csv            â”‚            â”‚
â”‚   â”‚    s3://tcpl-sagemaker/ml-features/test.csv             â”‚            â”‚
â”‚   â”‚    s3://tcpl-sagemaker/ml-features/preprocessing.joblib â”‚            â”‚
â”‚   â”‚    (scaler, encoders, feature names)                     â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ STEP 2: MODEL TRAINING (SageMaker)                       â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Algorithm: XGBoost (AWS Built-in)                        â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Training Job Configuration:                              â”‚            â”‚
â”‚   â”‚ â”œâ”€ Instance: ml.m5.2xlarge (8 vCPU, 32 GB RAM)         â”‚            â”‚
â”‚   â”‚ â”œâ”€ Instance count: 1                                     â”‚            â”‚
â”‚   â”‚ â”œâ”€ Volume: 50 GB                                         â”‚            â”‚
â”‚   â”‚ â””â”€ Max runtime: 1 hour                                   â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Hyperparameters:                                          â”‚            â”‚
â”‚   â”‚ {                                                         â”‚            â”‚
â”‚   â”‚   "objective": "reg:squarederror",  # Regression         â”‚            â”‚
â”‚   â”‚   "num_round": 100,    # Boosting rounds                â”‚            â”‚
â”‚   â”‚   "max_depth": 6,      # Tree depth                     â”‚            â”‚
â”‚   â”‚   "eta": 0.3,          # Learning rate                  â”‚            â”‚
â”‚   â”‚   "gamma": 0,          # Min loss reduction              â”‚            â”‚
â”‚   â”‚   "min_child_weight": 1,                                â”‚            â”‚
â”‚   â”‚   "subsample": 0.8,    # Row subsample ratio            â”‚            â”‚
â”‚   â”‚   "colsample_bytree": 0.8  # Column subsample           â”‚            â”‚
â”‚   â”‚ }                                                         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Training Process:                                         â”‚            â”‚
â”‚   â”‚ 1. Load train.csv from S3                                â”‚            â”‚
â”‚   â”‚ 2. Train XGBoost model                                   â”‚            â”‚
â”‚   â”‚ 3. Validate on test.csv                                  â”‚            â”‚
â”‚   â”‚ 4. Calculate metrics:                                    â”‚            â”‚
â”‚   â”‚    â€¢ RMSE (Root Mean Squared Error)                     â”‚            â”‚
â”‚   â”‚    â€¢ MAE (Mean Absolute Error)                           â”‚            â”‚
â”‚   â”‚    â€¢ RÂ² (R-squared score)                                â”‚            â”‚
â”‚   â”‚ 5. Save model artifacts:                                 â”‚            â”‚
â”‚   â”‚    s3://tcpl-sagemaker/models/model.tar.gz              â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Training Logs (CloudWatch):                              â”‚            â”‚
â”‚   â”‚ [0]    train-rmse:25.34  validation-rmse:26.12          â”‚            â”‚
â”‚   â”‚ [10]   train-rmse:12.56  validation-rmse:13.23          â”‚            â”‚
â”‚   â”‚ [20]   train-rmse:8.90   validation-rmse:9.56           â”‚            â”‚
â”‚   â”‚ ...                                                       â”‚            â”‚
â”‚   â”‚ [99]   train-rmse:5.65   validation-rmse:6.36           â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Final Metrics:                                            â”‚            â”‚
â”‚   â”‚ âœ“ RMSE: 6.36% (predicting within Â±6% lift)             â”‚            â”‚
â”‚   â”‚ âœ“ MAE: 4.87%                                             â”‚            â”‚
â”‚   â”‚ âœ“ RÂ²: 0.78 (78% variance explained)                     â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Duration: ~10 minutes                                     â”‚            â”‚
â”‚   â”‚ Cost: ~$0.50 per training run                            â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ STEP 3: MODEL REGISTRY                                   â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ SageMaker Model Registry                                 â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Model Package Group: promo-lift-prediction-models        â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Registered Models:                                        â”‚            â”‚
â”‚   â”‚ â”œâ”€ v1 (2024-01-15)                                       â”‚            â”‚
â”‚   â”‚ â”‚  Status: Approved                                      â”‚            â”‚
â”‚   â”‚ â”‚  Metrics: RMSE=7.2, RÂ²=0.72                           â”‚            â”‚
â”‚   â”‚ â”‚  Note: Baseline model                                  â”‚            â”‚
â”‚   â”‚ â”‚                                                         â”‚            â”‚
â”‚   â”‚ â”œâ”€ v2 (2024-02-01)                                       â”‚            â”‚
â”‚   â”‚ â”‚  Status: Approved (PRODUCTION)                         â”‚            â”‚
â”‚   â”‚ â”‚  Metrics: RMSE=6.8, RÂ²=0.75                           â”‚            â”‚
â”‚   â”‚ â”‚  Note: Added interaction features                      â”‚            â”‚
â”‚   â”‚ â”‚                                                         â”‚            â”‚
â”‚   â”‚ â””â”€ v3 (2024-02-20)                                       â”‚            â”‚
â”‚   â”‚    Status: PendingManualApproval                         â”‚            â”‚
â”‚   â”‚    Metrics: RMSE=6.36, RÂ²=0.78                          â”‚            â”‚
â”‚   â”‚    Note: Latest training, awaiting approval              â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Approval Workflow:                                        â”‚            â”‚
â”‚   â”‚ 1. Model trained â†’ Auto-registered                       â”‚            â”‚
â”‚   â”‚ 2. Status: PendingManualApproval                         â”‚            â”‚
â”‚   â”‚ 3. ML Engineer reviews metrics                           â”‚            â”‚
â”‚   â”‚ 4. If improved â†’ Approve                                 â”‚            â”‚
â”‚   â”‚ 5. If approved â†’ Deploy to endpoint                      â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ STEP 4: BATCH INFERENCE (Daily Predictions)             â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Use Case: Predict lift for all upcoming promotions      â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Process:                                                  â”‚            â”‚
â”‚   â”‚ 1. Query upcoming promotions from Snowflake:            â”‚            â”‚
â”‚   â”‚    SELECT * FROM GOLD.PROMO_ROI_DASHBOARD               â”‚            â”‚
â”‚   â”‚    WHERE promo_status = 'Upcoming'                       â”‚            â”‚
â”‚   â”‚    AND start_date >= CURRENT_DATE()                      â”‚            â”‚
â”‚   â”‚    LIMIT 10000                                           â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 2. Prepare features (same as training)                  â”‚            â”‚
â”‚   â”‚    Apply saved preprocessing.joblib                      â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 3. Save to S3 as CSV:                                    â”‚            â”‚
â”‚   â”‚    s3://tcpl-sagemaker/inference/input/batch_20240220.csvâ”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 4. Run SageMaker Batch Transform:                        â”‚            â”‚
â”‚   â”‚    Job Name: promo-lift-batch-inference-20240220        â”‚            â”‚
â”‚   â”‚    Model: promo-lift-v2 (approved production model)     â”‚            â”‚
â”‚   â”‚    Instance: ml.m5.xlarge                                â”‚            â”‚
â”‚   â”‚    Input: s3://.../inference/input/batch_20240220.csv   â”‚            â”‚
â”‚   â”‚    Output: s3://.../inference/output/batch_20240220.csv.outâ”‚          â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 5. Process predictions:                                  â”‚            â”‚
â”‚   â”‚    Read output CSV                                       â”‚            â”‚
â”‚   â”‚    Join with promotion_ids                               â”‚            â”‚
â”‚   â”‚    Result:                                                â”‚            â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚            â”‚
â”‚   â”‚    â”‚promotion_id â”‚ predicted_lift_pct   â”‚               â”‚            â”‚
â”‚   â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚            â”‚
â”‚   â”‚    â”‚PROMO_001    â”‚ 23.5%                â”‚               â”‚            â”‚
â”‚   â”‚    â”‚PROMO_002    â”‚ 18.7%                â”‚               â”‚            â”‚
â”‚   â”‚    â”‚PROMO_003    â”‚ 31.2%                â”‚               â”‚            â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 6. Load predictions to Snowflake:                        â”‚            â”‚
â”‚   â”‚    Table: ANALYTICS_PROD.ML_PREDICTIONS.PROMO_LIFT      â”‚            â”‚
â”‚   â”‚    Columns:                                               â”‚            â”‚
â”‚   â”‚    â€¢ promotion_id                                        â”‚            â”‚
â”‚   â”‚    â€¢ predicted_lift_pct                                  â”‚            â”‚
â”‚   â”‚    â€¢ prediction_timestamp                                â”‚            â”‚
â”‚   â”‚    â€¢ model_version (v2)                                  â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Schedule: Daily via Airflow (after Gold layer updates)  â”‚            â”‚
â”‚   â”‚ Duration: ~10 minutes for 10K promotions                â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ STEP 5: REAL-TIME INFERENCE (Optional - API Endpoint)   â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ SageMaker Real-time Endpoint                             â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Endpoint Configuration:                                   â”‚            â”‚
â”‚   â”‚ â”œâ”€ Name: promo-lift-prediction-endpoint                 â”‚            â”‚
â”‚   â”‚ â”œâ”€ Model: promo-lift-v2                                  â”‚            â”‚
â”‚   â”‚ â”œâ”€ Instance: ml.t2.medium (2 vCPU, 4 GB)               â”‚            â”‚
â”‚   â”‚ â”œâ”€ Initial instances: 1                                  â”‚            â”‚
â”‚   â”‚ â”œâ”€ Auto-scaling: 1-5 instances                           â”‚            â”‚
â”‚   â”‚ â””â”€ Scale trigger: InvocationsPerInstance > 1000         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ API Gateway Integration:                                  â”‚            â”‚
â”‚   â”‚ â”œâ”€ Endpoint: https://api.tcpl.com/ml/predict-lift       â”‚            â”‚
â”‚   â”‚ â”œâ”€ Method: POST                                          â”‚            â”‚
â”‚   â”‚ â””â”€ Authentication: API Key                               â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Request:                                                  â”‚            â”‚
â”‚   â”‚ POST https://api.tcpl.com/ml/predict-lift               â”‚            â”‚
â”‚   â”‚ {                                                         â”‚            â”‚
â”‚   â”‚   "promotion": {                                         â”‚            â”‚
â”‚   â”‚     "product_id": "SKU_1234",                            â”‚            â”‚
â”‚   â”‚     "discount_percentage": 25.0,                         â”‚            â”‚
â”‚   â”‚     "duration_days": 14,                                 â”‚            â”‚
â”‚   â”‚     "budget": 50000,                                     â”‚            â”‚
â”‚   â”‚     "start_month": 3,                                    â”‚            â”‚
â”‚   â”‚     "is_weekend": 0,                                     â”‚            â”‚
â”‚   â”‚     ... (other features)                                 â”‚            â”‚
â”‚   â”‚   }                                                       â”‚            â”‚
â”‚   â”‚ }                                                         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Response (< 100ms):                                      â”‚            â”‚
â”‚   â”‚ {                                                         â”‚            â”‚
â”‚   â”‚   "predicted_lift_pct": 23.5,                            â”‚            â”‚
â”‚   â”‚   "confidence_interval": [18.2, 28.8],                  â”‚            â”‚
â”‚   â”‚   "model_version": "v2",                                 â”‚            â”‚
â”‚   â”‚   "prediction_timestamp": "2024-02-20T15:30:45Z"        â”‚            â”‚
â”‚   â”‚ }                                                         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Use Case: Marketing team gets instant predictions       â”‚            â”‚
â”‚   â”‚ for "what-if" scenarios                                  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚                        â†“                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ STEP 6: MODEL MONITORING (SageMaker Model Monitor)      â”‚            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Monitoring Schedule: Hourly                              â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ What's Monitored:                                         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 1. DATA QUALITY MONITORING                               â”‚            â”‚
â”‚   â”‚    Checks input data for anomalies:                      â”‚            â”‚
â”‚   â”‚    â€¢ Missing features                                    â”‚            â”‚
â”‚   â”‚    â€¢ Out-of-range values                                 â”‚            â”‚
â”‚   â”‚    â€¢ Feature distribution shift                          â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 2. MODEL QUALITY MONITORING                              â”‚            â”‚
â”‚   â”‚    Tracks prediction accuracy over time:                 â”‚            â”‚
â”‚   â”‚    â€¢ Compare predictions vs actuals                      â”‚            â”‚
â”‚   â”‚    â€¢ Calculate ongoing RMSE, MAE                         â”‚            â”‚
â”‚   â”‚    â€¢ Detect accuracy degradation                         â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 3. BIAS DRIFT                                            â”‚            â”‚
â”‚   â”‚    Checks for bias in predictions:                       â”‚            â”‚
â”‚   â”‚    â€¢ By region (is model fair across regions?)          â”‚            â”‚
â”‚   â”‚    â€¢ By product category                                 â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ 4. FEATURE ATTRIBUTION DRIFT                             â”‚            â”‚
â”‚   â”‚    Tracks which features drive predictions:              â”‚            â”‚
â”‚   â”‚    â€¢ Are feature importances changing?                   â”‚            â”‚
â”‚   â”‚    â€¢ SHAP values over time                               â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Alerts (CloudWatch â†’ SNS â†’ Slack):                       â”‚            â”‚
â”‚   â”‚ â€¢ Data quality violation detected                        â”‚            â”‚
â”‚   â”‚ â€¢ Model accuracy dropped by >10%                         â”‚            â”‚
â”‚   â”‚ â€¢ Feature drift detected                                 â”‚            â”‚
â”‚   â”‚                                                           â”‚            â”‚
â”‚   â”‚ Action: Trigger model retraining if drift detected      â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          ORCHESTRATION (AIRFLOW)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¼ MASTER ORCHESTRATION DAG                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   DAG: cpg_analytics_master_pipeline                                        â”‚
â”‚   Schedule: 0 2 * * * (Daily at 2 AM)                                      â”‚
â”‚   Owner: data-engineering                                                   â”‚
â”‚                                                                             â”‚
â”‚   Flow:                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚  START                                                      â”‚          â”‚
â”‚   â”‚    â†“                                                        â”‚          â”‚
â”‚   â”‚  [Check S3 Landing Zone] (S3 Sensor)                       â”‚          â”‚
â”‚   â”‚    â†“ (files exist?)                                        â”‚          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚          â”‚
â”‚   â”‚  â”‚ BRONZE LAYER â”‚                                          â”‚          â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Run Glue Job: bronze-promo-ingestion                 â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Wait for completion                                   â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Validate data quality                                â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Check rejection rate < 5%                            â”‚          â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚          â”‚
â”‚   â”‚         â†“                                                   â”‚          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚          â”‚
â”‚   â”‚  â”‚ SILVER LAYER â”‚                                          â”‚          â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Run Glue Job: silver-promo-transformation            â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Wait for completion                                   â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Validate transformations                             â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Check unprofitable % < 15%                           â”‚          â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚          â”‚
â”‚   â”‚         â†“                                                   â”‚          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚          â”‚
â”‚   â”‚  â”‚ GOLD LAYER   â”‚                                          â”‚          â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Snowpipe loads data (automatic)                      â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Run dbt: dbt run --target prod                       â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Run dbt tests: dbt test --target prod                â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Validate record counts in Gold tables               â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Check data freshness < 6 hours                       â”‚          â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚          â”‚
â”‚   â”‚         â†“                                                   â”‚          â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚          â”‚
â”‚   â”‚  â”‚ ML INFERENCE â”‚                                          â”‚          â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Query upcoming promotions (Snowflake)                â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Prepare features                                      â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Run SageMaker Batch Transform                        â”‚          â”‚
â”‚   â”‚  â”‚ â€¢ Load predictions to Snowflake                        â”‚          â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚          â”‚
â”‚   â”‚         â†“                                                   â”‚          â”‚
â”‚   â”‚  [Send Success Notification] (Slack/Email)                â”‚          â”‚
â”‚   â”‚    â†“                                                        â”‚          â”‚
â”‚   â”‚  END                                                        â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚  Error Handling:                                            â”‚          â”‚
â”‚   â”‚  â€¢ Each task has 2 retries (5 min delay)                  â”‚          â”‚
â”‚   â”‚  â€¢ On failure â†’ Send alert to #data-pipeline-alerts       â”‚          â”‚
â”‚   â”‚  â€¢ Critical failures â†’ Page on-call engineer               â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚   Duration: ~45 minutes end-to-end                                         â”‚
â”‚   Success Rate: >99.5% (last 30 days)                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           CI/CD PIPELINE (GITHUB ACTIONS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ CONTINUOUS INTEGRATION / CONTINUOUS DEPLOYMENT                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Trigger: git push / Pull Request                                          â”‚
â”‚                                                                             â”‚
â”‚   CI PIPELINE (Pull Request):                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ 1. Code Quality                                             â”‚          â”‚
â”‚   â”‚    â€¢ Lint (pylint, flake8, black)                          â”‚          â”‚
â”‚   â”‚    â€¢ Security scan (Bandit)                                â”‚          â”‚
â”‚   â”‚    â€¢ SQL lint (sqlfluff)                                   â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 2. Unit Tests                                               â”‚          â”‚
â”‚   â”‚    â€¢ pytest (all test files)                               â”‚          â”‚
â”‚   â”‚    â€¢ Coverage check (>80%)                                 â”‚          â”‚
â”‚   â”‚    â€¢ Upload to CodeCov                                      â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 3. Integration Tests                                        â”‚          â”‚
â”‚   â”‚    â€¢ Spin up Docker containers                             â”‚          â”‚
â”‚   â”‚    â€¢ Test Glue jobs (mocked)                               â”‚          â”‚
â”‚   â”‚    â€¢ Test Lambda functions                                 â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 4. Data Quality Tests                                       â”‚          â”‚
â”‚   â”‚    â€¢ Great Expectations validation                         â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ 5. Build Artifacts                                          â”‚          â”‚
â”‚   â”‚    â€¢ Package Glue scripts                                  â”‚          â”‚
â”‚   â”‚    â€¢ Package Lambda functions                              â”‚          â”‚
â”‚   â”‚    â€¢ Upload to S3                                          â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Result: âœ… All pass â†’ Can merge | âŒ Fail â†’ Block merge   â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚   CD PIPELINE (Merge to main):                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ Deploy to DEV (Automatic)                                  â”‚          â”‚
â”‚   â”‚   â€¢ Deploy Glue jobs                                       â”‚          â”‚
â”‚   â”‚   â€¢ Deploy Lambda functions                                â”‚          â”‚
â”‚   â”‚   â€¢ Run dbt models                                         â”‚          â”‚
â”‚   â”‚   â€¢ Smoke tests                                            â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Deploy to STAGING (Manual approval)                        â”‚          â”‚
â”‚   â”‚   â€¢ Terraform plan & apply                                 â”‚          â”‚
â”‚   â”‚   â€¢ Deploy all components                                  â”‚          â”‚
â”‚   â”‚   â€¢ Full integration tests                                 â”‚          â”‚
â”‚   â”‚   â€¢ Performance tests                                      â”‚          â”‚
â”‚   â”‚                                                             â”‚          â”‚
â”‚   â”‚ Deploy to PRODUCTION (Manual approval)                     â”‚          â”‚
â”‚   â”‚   â€¢ Blue-Green deployment                                  â”‚          â”‚
â”‚   â”‚   â€¢ Deploy to green environment                            â”‚          â”‚
â”‚   â”‚   â€¢ Smoke tests on green                                   â”‚          â”‚
â”‚   â”‚   â€¢ Switch traffic to green                                â”‚          â”‚
â”‚   â”‚   â€¢ Monitor for 15 minutes                                 â”‚          â”‚
â”‚   â”‚   â€¢ Keep blue as rollback (1 hour)                         â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         MONITORING & OBSERVABILITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š COMPLETE MONITORING STACK                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   CLOUDWATCH DASHBOARDS:                                                    â”‚
â”‚   â”œâ”€ Pipeline Health Dashboard                                             â”‚
â”‚   â”‚  â€¢ Glue job success rates                                              â”‚
â”‚   â”‚  â€¢ Lambda execution times                                              â”‚
â”‚   â”‚  â€¢ Airflow DAG status                                                  â”‚
â”‚   â”‚  â€¢ Data quality rejection rates                                        â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€ Streaming Metrics Dashboard                                           â”‚
â”‚   â”‚  â€¢ Kafka consumer lag                                                  â”‚
â”‚   â”‚  â€¢ Events per second                                                   â”‚
â”‚   â”‚  â€¢ Processing latency                                                  â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€ ML Performance Dashboard                                              â”‚
â”‚   â”‚  â€¢ Model accuracy over time                                            â”‚
â”‚   â”‚  â€¢ Prediction latency                                                  â”‚
â”‚   â”‚  â€¢ Feature drift metrics                                               â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â””â”€ Cost Dashboard                                                        â”‚
â”‚      â€¢ Daily AWS spend                                                     â”‚
â”‚      â€¢ Cost by service                                                     â”‚
â”‚      â€¢ Snowflake credit usage                                              â”‚
â”‚                                                                             â”‚
â”‚   ALERTS (SNS â†’ Slack):                                                    â”‚
â”‚   â€¢ Pipeline failure â†’ #data-pipeline-alerts                               â”‚
â”‚   â€¢ Data quality breach â†’ #data-quality-alerts                             â”‚
â”‚   â€¢ Model drift detected â†’ #ml-alerts                                      â”‚
â”‚   â€¢ High cost anomaly â†’ #finops-alerts                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **ONE-PAGE TECHNICAL QUICK REFERENCE**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               TECHNICAL STACK QUICK GLANCE                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  BATCH PIPELINE:                                               â•‘
â•‘  CSV â†’ S3 â†’ Glue (Bronze) â†’ Glue (Silver) â†’ Snowflake (Gold) â•‘
â•‘        â†“        â†“              â†“                â†“              â•‘
â•‘     Parquet  PySpark      Enrichment          dbt             â•‘
â•‘                                                                â•‘
â•‘  STREAMING:                                                    â•‘
â•‘  Events â†’ Kafka (MSK) â†’ Lambda/Flink â†’ S3/Snowflake/DynamoDB â•‘
â•‘           â†“             â†“                                      â•‘
â•‘        12 partitions  Real-time processing                    â•‘
â•‘                                                                â•‘
â•‘  ML PIPELINE:                                                  â•‘
â•‘  Snowflake â†’ Features â†’ SageMaker Training â†’ Model Registry   â•‘
â•‘     â†“          â†“             â†“                    â†“            â•‘
â•‘   Query    Snowpark      XGBoost          Batch/Real-time     â•‘
â•‘                                           Inference            â•‘
â•‘                                                                â•‘
â•‘  ORCHESTRATION:                                                â•‘
â•‘  Airflow DAG (Daily 2 AM) â†’ All layers â†’ ML â†’ Notifications  â•‘
â•‘                                                                â•‘
â•‘  CI/CD:                                                        â•‘
â•‘  Git Push â†’ Tests â†’ Build â†’ Dev â†’ Staging â†’ Production       â•‘
â•‘            â†“                                                   â•‘
â•‘      (All automated via GitHub Actions)                       â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**THIS IS YOUR TECHNICAL REFERENCE! Save it, refer to it daily when working!** ğŸš€

Print this or keep it open on a second monitor while working. It shows **EXACTLY** how the technical pieces fit together!
